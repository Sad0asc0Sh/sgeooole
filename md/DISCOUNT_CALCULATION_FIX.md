# ุฑูุน ุจุงฺฏ ูุญุงุณุจู ุชุฎูู ุฏุฑ ูพูู ุงุฏูู

## ๐ ูุดฺฉู ุงุตู

ุฏุฑ ูพูู ุงุฏููุ ููฺฏุงู ูุฑุงุด ูุญุตููุงุช ุฏุงุฑุง ุชุฎููุ ููุช ุงุตู ูุญุตูู ุจุง ููุช ุชุฎููโุฎูุฑุฏู ุฌุงฺฏุฒู ูโุดุฏ ู ุฏุฑ ูุชุฌู:
- ููุช ุงุตู ูุญุตูู ุงุฒ ุจู ูโุฑูุช
- ุจุง ูุฑ ุจุงุฑ ูุฑุงุดุ ุชุฎูู ุฏูุจุงุฑู ุฑู ููุช ุชุฎููโุฎูุฑุฏู ุงุนูุงู ูโุดุฏ
- ููุชโูุง ุจู ุตูุฑุช ูุงุฏุฑุณุช ฺฉุงูุด ูพุฏุง ูโฺฉุฑุฏูุฏ

### ูุซุงู ุงุฒ ูุดฺฉู:
```
ูุญุตูู ุงุตู: 1,000,000 ุชููุงู
ุชุฎูู: 20%

ุฏูุนู ุงูู ูุฑุงุด:
- ููุช ููุงุด: 800,000 ุชููุงู (1,000,000 - 20%)
- ุจุนุฏ ุงุฒ ุฐุฎุฑู: ููุช ุงุตู = 800,000 ุชููุงู โ

ุฏูุนู ุฏูู ูุฑุงุด:
- ููุช ููุงุด: 640,000 ุชููุงู (800,000 - 20%)
- ุจุนุฏ ุงุฒ ุฐุฎุฑู: ููุช ุงุตู = 640,000 ุชููุงู โ
```

## ๐ ุชุญูู ุนูุช ูุดฺฉู

### ุฑููุฏ ุจุงฺฏ:
1. **ุฏุฑุงูุช ูุญุตูู ุจุฑุง ูุฑุงุด** ([products.js:565-677](welfvita-backend/routes/products.js#L565-L677))
   - ููุช ุงุฏูู ูุญุตูู ุฑุง ุจุฑุง ูุฑุงุด ุจุงุฒ ูโฺฉุฑุฏุ ุจฺฉโุงูุฏ ุชุฎูู ุฑุง ูุญุงุณุจู ู ุงุนูุงู ูโฺฉุฑุฏ
   - ุฏุฑ ุฎุทูุท 647-650ุ ููุช ุงุตู ุจุง ููุช ุชุฎููโุฎูุฑุฏู ุฌุงฺฏุฒู ูโุดุฏ:
   ```javascript
   const originalPrice = productObj.price
   const discountAmount = (originalPrice * activeSale.discountPercentage) / 100
   productObj.price = originalPrice - discountAmount  // โ ููุช ุงุตู ุฌุงฺฏุฒู ูุดู
   ```

2. **ุฐุฎุฑู ุชุบุฑุงุช** ([ProductForm.jsx:329-431](admin/src/pages/products/ProductForm.jsx#L329-L431))
   - ูุฑู ุงุฏูู ููุช ุชุฎููโุฎูุฑุฏู ุฑุง ุฏุฑุงูุช ูโฺฉุฑุฏ
   - ุงู ููุช ุฑุง ุจู ุนููุงู ููุช ุฌุฏุฏ ูุญุตูู ุฐุฎุฑู ูโฺฉุฑุฏ
   - ุฏุฑ ูุชุฌู ููุช ุงุตู ุงุฒ ุฏุณุช ูโุฑูุช

3. **ููุงุด ูุณุช ูุญุตููุงุช**
   - ุฏุฑ ูุณุช ูุญุตููุงุช ูพูู ุงุฏูู ูุฒ ููุชโูุง ุชุฎููโุฎูุฑุฏู ููุงุด ุฏุงุฏู ูโุดุฏ
   - ุงู ููุถูุน ุจุงุนุซ ุณุฑุฏุฑฺฏู ุงุฏูู ูโุดุฏ

## โ ุฑุงู ุญู ูพุงุฏูโุณุงุฒ ุดุฏู

### 1. ุงูุฒูุฏู ูพุงุฑุงูุชุฑ `skipDiscount` ุจู API

#### Backend - ูุงู `welfvita-backend/routes/products.js`

**ุชุบุฑุงุช ุฏุฑ endpoint ุฏุฑุงูุช ุชฺฉ ูุญุตูู (GET /api/products/:id):**

```javascript
// โ ุงุถุงูู ุดุฏู
const skipDiscount = req.query.skipDiscount === 'true';

// If skipDiscount is true, return raw product data without discount calculation
// This is used for admin editing to preserve original prices
if (skipDiscount) {
  return res.json({
    success: true,
    data: productObj,
  })
}
```

**ุชุบุฑุงุช ุฏุฑ endpoint ูุณุช ูุญุตููุงุช (GET /api/products):**

```javascript
// โ ุงุถุงูู ุดุฏู
const skipDiscount = req.query.skipDiscount === 'true';

// Apply discounts to products (skip if skipDiscount is true for admin panel)
const itemsWithCampaign = skipDiscount ? items : items.map((item) => {
  // ูุญุงุณุจู ุชุฎูู...
})
```

### 2. ุงุณุชูุงุฏู ุงุฒ ูพุงุฑุงูุชุฑ ุฏุฑ ูพูู ุงุฏูู

#### Frontend - ูุงู `admin/src/pages/products/ProductForm.jsx`

**ุฏุฑุงูุช ูุญุตูู ุจุฑุง ูุฑุงุด:**

```javascript
// โ FIX: Use skipDiscount=true to get raw product data without discount calculation
// This ensures we get the original price, not the discounted price
const res = await api.get(`/products/${id}?skipDiscount=true`)
```

#### Frontend - ูุงู `admin/src/pages/products/ProductsList.jsx`

**ุฏุฑุงูุช ูุณุช ูุญุตููุงุช:**

```javascript
// โ FIX: Get raw prices for admin panel (without discount calculation)
params.set('skipDiscount', 'true')
```

## ๐ ูุชุฌู

### ูุจู ุงุฒ ุฑูุน ุจุงฺฏ:
```
ูุญุตูู: 1,000,000 ุชููุงู ุจุง 20% ุชุฎูู

ูุฑุงุด 1 โ ููุช ุฐุฎุฑู ุดุฏู: 800,000 ุชููุงู โ
ูุฑุงุด 2 โ ููุช ุฐุฎุฑู ุดุฏู: 640,000 ุชููุงู โ
ูุฑุงุด 3 โ ููุช ุฐุฎุฑู ุดุฏู: 512,000 ุชููุงู โ
```

### ุจุนุฏ ุงุฒ ุฑูุน ุจุงฺฏ:
```
ูุญุตูู: 1,000,000 ุชููุงู ุจุง 20% ุชุฎูู

ูุฑุงุด 1 โ ููุช ุฐุฎุฑู ุดุฏู: 1,000,000 ุชููุงู โ
ูุฑุงุด 2 โ ููุช ุฐุฎุฑู ุดุฏู: 1,000,000 ุชููุงู โ
ูุฑุงุด 3 โ ููุช ุฐุฎุฑู ุดุฏู: 1,000,000 ุชููุงู โ

ููุช ููุงุด ุจุฑุง ฺฉุงุฑุจุฑุงู: 800,000 ุชููุงู โ
```

## ๐ฏ ูุฒุงุง ุงู ุฑุงู ุญู

1. **ุญูุธ ููุช ุงุตู**: ููุช ุงุตู ูุญุตููุงุช ุฏุฑ ุฏุชุงุจุณ ุญูุธ ูโุดูุฏ
2. **ุนุฏู ุชุบุฑ ุฑูุชุงุฑ ุณุงุช**: ฺฉุงุฑุจุฑุงู ููฺูุงู ููุชโูุง ุชุฎููโุฎูุฑุฏู ุฑุง ูโุจููุฏ
3. **ุณุงุฒฺฏุงุฑ ุจุง ุณุณุชู ููุฌูุฏ**: ูุงุฒ ุจู ุชุบุฑ ุณุงุฎุชุงุฑ ุฏุชุงุจุณ ูุณุช
4. **ูุงุจูุช ุจุงุฒฺฏุดุช**: ุจุง ุญุฐู ูพุงุฑุงูุชุฑ `skipDiscount` ุฑูุชุงุฑ ูุจู ุจุฑูโฺฏุฑุฏุฏ
5. **ุดูุงูุช ุจุฑุง ุงุฏูู**: ุงุฏููโูุง ููุชโูุง ูุงูุน ุฑุง ูโุจููุฏ

## ๐ง ูุงูโูุง ุชุบุฑ ุงูุชู

### Backend:
- โ [welfvita-backend/routes/products.js](welfvita-backend/routes/products.js)
  - ุฎุท 567-572: ุงูุฒูุฏู ูพุงุฑุงูุชุฑ skipDiscount ุจู GET /api/products/:id
  - ุฎุท 611-618: ุงุนูุงู ุดุฑุท skipDiscount
  - ุฎุท 204: ุงูุฒูุฏู ูพุงุฑุงูุชุฑ skipDiscount ุจู GET /api/products
  - ุฎุท 437: ุงุนูุงู ุดุฑุท skipDiscount ุฏุฑ ูุณุช ูุญุตููุงุช

- โ [welfvita-backend/middleware/cache.js](welfvita-backend/middleware/cache.js)
  - ุฎุท 22-29: ุบุฑูุนุงู ฺฉุฑุฏู browser & server cache ุจุฑุง ุฏุฑุฎูุงุณุชโูุง ุงุฏูู

### Frontend (Admin Panel):
- โ [admin/src/pages/products/ProductForm.jsx](admin/src/pages/products/ProductForm.jsx)
  - ุฎุท 101-103: ุงุณุชูุงุฏู ุงุฒ skipDiscount ุฏุฑ ุฏุฑุงูุช ูุญุตูู

- โ [admin/src/pages/products/ProductsList.jsx](admin/src/pages/products/ProductsList.jsx)
  - ุฎุท 78-79: ุงุณุชูุงุฏู ุงุฒ skipDiscount ุฏุฑ ูุณุช ูุญุตููุงุช

## ๐งช ุชุณุช ู ุจุฑุฑุณ

### ุณูุงุฑููุง ุชุณุช:

1. **ุงุฌุงุฏ ูุญุตูู ุฌุฏุฏ ุจุง ุชุฎูู:**
   - โ ููุช ุงุตู ุตุญุญ ุฐุฎุฑู ุดูุฏ
   - โ ุฏุฑุตุฏ ุชุฎูู ุตุญุญ ุงุนูุงู ุดูุฏ

2. **ูุฑุงุด ูุญุตูู ุจุง ุชุฎูู:**
   - โ ููุช ุงุตู ุฏุฑ ูุฑู ููุงุด ุฏุงุฏู ุดูุฏ
   - โ ููุช ุงุตู ุจุนุฏ ุงุฒ ุฐุฎุฑู ุชุบุฑ ูฺฉูุฏ
   - โ ุฏุฑุตุฏ ุชุฎูู ูุงุจู ูุฑุงุด ุจุงุดุฏ

3. **ุชุบุฑ ุฏุฑุตุฏ ุชุฎูู:**
   - โ ุจุง ุงูุฒุงุด ุชุฎููุ ููุช ุงุตู ุซุงุจุช ุจูุงูุฏ
   - โ ุจุง ฺฉุงูุด ุชุฎููุ ููุช ุงุตู ุซุงุจุช ุจูุงูุฏ

4. **ููุงุด ุฏุฑ ุณุงุช:**
   - โ ฺฉุงุฑุจุฑุงู ููุช ุชุฎููโุฎูุฑุฏู ุฑุง ุจุจููุฏ
   - โ ููุช ุงุตู ุฏุฑ compareAtPrice ููุงุด ุฏุงุฏู ุดูุฏ

5. **ููุงุด ุฏุฑ ูพูู ุงุฏูู:**
   - โ ูุณุช ูุญุตููุงุช ููุช ุงุตู ุฑุง ูุดุงู ุฏูุฏ
   - โ ูุฑู ูุฑุงุด ููุช ุงุตู ุฑุง ูุดุงู ุฏูุฏ

6. **ุชุณุช ฺฉุด (ุจุฏูู ูุงุฒ ุจู ูพุงฺฉ ฺฉุฑุฏู):**
   - โ ูุญุตูู ุฑุง ูุฑุงุด ฺฉูุฏ ู ููุช ุฑุง ุชุบุฑ ุฏูุฏ
   - โ ููุท ุจุง ุฑูุฑุด ูุนููู (F5) ุตูุญู ุฑุง ุจุงุฑฺฏุฐุงุฑ ฺฉูุฏ
   - โ ุชุบุฑุงุช ุจุงุฏ ุจูุงูุงุตูู ููุงุด ุฏุงุฏู ุดูุฏ
   - โ ูุงุฒ ุจู Ctrl+Shift+Delete ุง Hard Refresh ูุณุช

## ๐ซ ูุดฺฉู ุฏูู: Browser Caching

### ูุดฺฉู:
ุจุนุฏ ุงุฒ ุฑูุน ุจุงฺฏ ุงุตูุ ูุดฺฉู ุฌุฏุฏ ูพุด ุขูุฏ:
- ุชุบุฑุงุช ุจุง ููููุช ุฐุฎุฑู ูโุดุฏูุฏ
- ุงูุง ุชููุง ุจุง **ูพุงฺฉ ฺฉุฑุฏู ฺฉุด ูุฑูุฑฺฏุฑ** ููุงุด ุฏุงุฏู ูโุดุฏูุฏ
- ุฑูุฑุด ูุนููู ุตูุญู ฺฉุงู ูุจูุฏ

### ุนูุช:
Server ุงู header ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```http
Cache-Control: public, max-age=3600
```

ุงู ุจุงุนุซ ูโุดุฏ ูุฑูุฑฺฏุฑ response ุฑุง ุจุฑุง ฑ ุณุงุนุช ฺฉุด ฺฉูุฏ. ุญุช ุงฺฏุฑ server-side cache ูพุงฺฉ ูโุดุฏุ ูุฑูุฑฺฏุฑ ููฺูุงู ุงุฒ ฺฉุด ูุญู ุฎูุฏ ุงุณุชูุงุฏู ูโฺฉุฑุฏ!

### ุฑุงู ุญู:
ุฏุฑ [middleware/cache.js](welfvita-backend/middleware/cache.js#L22-L29)ุ ุจุฑุง ุฏุฑุฎูุงุณุชโูุง ุงุฏูู (ุจุง `skipDiscount=true`) ฺฉุด ุฑุง ฺฉุงููุงู ุบุฑูุนุงู ฺฉุฑุฏู:

```javascript
if (req.query.skipDiscount === 'true') {
  res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, private')
  res.setHeader('Pragma', 'no-cache')
  res.setHeader('Expires', '0')
  return next()
}
```

**ูุชุฌู:**
- โ ุชุบุฑุงุช ุจูุงูุงุตูู ุจุง ุฑูุฑุด ูุนููู ููุงุด ุฏุงุฏู ูโุดููุฏ
- โ ูุงุฒ ุจู ูพุงฺฉ ฺฉุฑุฏู ฺฉุด ูุฑูุฑฺฏุฑ ูุณุช
- โ ุฏุฑุฎูุงุณุชโูุง ุนููู ููฺูุงู ุงุฒ ฺฉุด ุงุณุชูุงุฏู ูโฺฉููุฏ (ุจูููโุณุงุฒ ุณุฑุนุช)

## ๐ ูฺฉุงุช ููู

- ุงู ุชุบุฑุงุช **ููุท** ุจุฑุง ูพูู ุงุฏูู ุงุนูุงู ูโุดูุฏ
- ุณุงุช ุงุตู ู APIูุง ุนููู ููฺูุงู ุชุฎูู ุฑุง ูุญุงุณุจู ู ููุงุด ูโุฏููุฏ
- ุจุฑุง ูุญุตููุงุช ูุชุบุฑ (variable products) ูุฒ ุงู ุฑูุน ุจุงฺฏ ฺฉุงุฑ ูโฺฉูุฏ
- ูุญุตููุงุช ฺฉู ุฏุฑ ฺฉููพูโูุง ูุฑูุด (Sales) ูุฑุงุฑ ุฏุงุฑูุฏ ูุฒ ุชุญุช ุชุงุซุฑ ุงู ุฑูุน ุจุงฺฏ ูุณุชูุฏ
- **ุฏุฑุฎูุงุณุชโูุง ุงุฏูู ุฏฺฏุฑ ฺฉุด ููโุดููุฏ** (ูู ุฏุฑ ุณุฑูุฑุ ูู ุฏุฑ ูุฑูุฑฺฏุฑ)

## ๐ ุงููุช

- ูพุงุฑุงูุชุฑ `skipDiscount` ููุท ุจุฑุง ุฎูุงูุฏู ุงุทูุงุนุงุช ุงุณุช
- ุชุบุฑ ุฏุฑ ุณุทุญ ุฏุณุชุฑุณ ุง ุงุญุฑุงุฒ ููุช ุงุฌุงุฏ ูุดุฏู
- ููู endpointูุง ุงุฏูู ููฺูุงู ูุงุฒ ุจู ุงุญุฑุงุฒ ููุช ุฏุงุฑูุฏ

---

## ๐ ุฎูุงุตู ุชุบุฑุงุช

### ุจุงฺฏ ฑ: ุชุฎูู ุงุดุชุจุงู ุฑู ููุช ุงุตู
- **ูุดฺฉู**: ููุช ุงุตู ุจุง ููุช ุชุฎููโุฎูุฑุฏู ุฌุงฺฏุฒู ูโุดุฏ
- **ุฑุงู ุญู**: ุงูุฒูุฏู ูพุงุฑุงูุชุฑ `skipDiscount=true` ุจุฑุง ุฏุฑุฎูุงุณุชโูุง ุงุฏูู

### ุจุงฺฏ ฒ: ฺฉุด ูุฑูุฑฺฏุฑ
- **ูุดฺฉู**: ุชุบุฑุงุช ููุท ุจุง ูพุงฺฉ ฺฉุฑุฏู ฺฉุด ููุงุด ุฏุงุฏู ูโุดุฏ
- **ุฑุงู ุญู**: ุบุฑูุนุงู ฺฉุฑุฏู browser & server cache ุจุฑุง ุฏุฑุฎูุงุณุชโูุง ุงุฏูู

---

**ุชุงุฑุฎ ุฑูุน ุจุงฺฏ:** 2025-12-02
**ูุณุฎู:** 2.0.0 (ุดุงูู ุฑูุน ูุดฺฉู ฺฉุด)
**ูุถุนุช:** โ ุชฺฉูู ุดุฏู ู ุขูุงุฏู ุงุณุชูุงุฏู
